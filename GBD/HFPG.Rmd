# High Fasting Plasma Glucose - GDB

Let's start with some useful links:

1.  [From DM2 to FPG (IHME)](https://github.com/ihmeuw/ihme-modeling/blob/master/gbd_2019/risk_factors_code/metab_fpg/crosswalk/dm_2_fpg.R)

2.  [Age-sex splitting for FPG (IHME)](https://github.com/ihmeuw/ihme-modeling/blob/master/gbd_2019/risk_factors_code/metab_fpg/age_sex_split/age_sex_split.R)

Some comments:

1.  Risk factor exposure is available upon REQUEST, and we have not requested;

## Setting things:

For our project, we will hugely rely on [Pintando e bordando no R](https://datathon-ufrgs.github.io/Pintando_e_Bordando_no_R/#1), by Rodrigo Citton P. dos Reis.

### Packages needed:

We will use **ggplot2** as the main package to generate plots using GBD data and **rnaturalearth** to generate maps.

```{r message=FALSE}
library(ggplot2)
library(ggthemes)
library(plotly)
library(tidyverse)
library(readr)
library(here)
# library(maps)
# library(ggmap)
# library(maptools)
library(rnaturalearth)
library(rnaturalearthdata)
library(rnaturalearthhires)
library(hrbrthemes)
library(shadowtext)
```

### Importing and organizing dataset:

```{r message=FALSE, warning=FALSE}
GBD <- readr::read_csv(file = here::here("GBD_vals.csv"))
GBD_2 <- readr::read_csv(file= here::here("GBD_2.csv"))
GBDrates <- readr::read_csv(file = here::here("GBD_ROC.csv"))
SDI <- readr::read_csv(file = here::here("GBD_SDI_1990_2019.csv"))
GBD_POP_2019 <- read_csv(file = here::here("GBD_POP_2019.CSV"))
GBD_POP_1990 <- read_csv(file = here::here("GBD_POP_1990.CSV"))
```

```{r message=FALSE, warning=FALSE, results='hide'}

GBD <- GBD %>% 
       bind_rows(GBD_2)
rm(GBD_2) #Dont waste my precious RAM

GBD <- GBD %>% 
       mutate(age = recode(age, "80-84" = "80-84 years",
                                "85-89" = "85-89 years",
                                "90-94" = "90-94 years"),
              year = as.factor(year))%>%
       mutate(age = as.factor(age#, levels = c("<5 years",                                                                        "5-9 years",
                                 #             "10-14 years",
                                  #            "15-19 years",
                                   #           "20-24 years",
                                    #          "25-29 years",
                                     #         "30-34 years",
                                      #        "35-39 years",
                                       #       "40-44 years",
                                        #      "45-49 years",
                                         #     "50-54 years",
                                          #    "55-59 years",
                                           #   "60-64 years",
                                            #  "65-69 years",
                                             # "70-74 years",
                                  #            "75-79 years",
                                   #           "80-84 years",
                                    #          "85-89 years",
                                     #         "90-94 years",
                                      #        "95+ years",
                                       #       "All ages",
                                        #      "Age-standardized")
                                )) %>% 
       mutate(measure = recode(measure,
             "YLDs (Years Lived with Disability)" = "YLDs",
             "YLLs (Years of Life Lost)" = "YLLs",
             "DALYs (Disability-Adjusted Life Years)" = "DALYs"),
              location = recode(location,
             "Bolivia (Plurinational State of)" = "Bolivia",
             "Venezuela (Bolivarian Republic of)" = "Venezuela"),
             val_cat = cut(x = GBD$val,
                           breaks = c(-Inf, 1, 10, 100, 500,
                                             1000, 2500, 5000, Inf),
                           labels = c("0 - 1",
                                      "1 - 10",
                                      "10 - 100",
                                      "100 - 500",
                                      "500 - 1000",
                                      "1000 - 2500",
                                      "2500 - 5000",
                                      ">5000")))
       

GBD_POP <-  GBD_POP_1990 %>%
            bind_rows(GBD_POP_2019) %>%
            rename(location = location_name,
                   sex = sex_name,
                   age = age_group_name,
                   year = year_id,
                   pop = val) %>% 
            select(location, sex, age, year, pop) %>%
            mutate(location = recode(location,
                   "Bolivia (Plurinational State of)" = "Bolivia",
                   "Venezuela (Bolivarian Republic of)" = "Venezuela"),
                   sex = recode(sex,
                   "both" = "Both",
                   "male" = "Male",
                   "female" = "Female"),
                   age = as.factor(age),
                   year = as.factor(year))%>%
            filter(location %in% c("Argentina",
                                   "Bolivia",
                                   "Brazil",
                                   "Chile",
                                   "Colombia",
                                   "Ecuador",
                                   "Guyana",
                                   "Paraguay",
                                   "Peru",
                                   "Suriname",
                                   "Uruguay",
                                   "Venezuela")) %>% 
            mutate(age = recode(age,  "Under 5"="<5 years",                                                              "5 to 9"="5-9 years",
                                      "10 to 14"="10-14 years",
                                      "15 to 19"="15-19 years",
                                      "20 to 24"="20-24 years",
                                      "25 to 29"="25-29 years",
                                      "30 to 34"="30-34 years",
                                      "35 to 39"="35-39 years",
                                      "40 to 44"="40-44 years",
                                      "45 to 49"="45-49 years",
                                      "50 to 54"="50-54 years",
                                      "55 to 59"="55-59 years",
                                      "60 to 64"="60-64 years",
                                      "65 to 69"="65-69 years",
                                      "70 to 74"="70-74 years",
                                      "75 to 79"="75-79 years",
                                      "80 to 84"="80-84 years",
                                      "85 to 89"="85-89 years",
                                      "90 to 94"="90-94 years",
                                      "95 plus"="95+ years",
                                      "All Ages" = "All ages")) %>% 
            filter(age %in% c("<5 years",                                                                        "5-9 years",
                              "10-14 years",
                              "15-19 years",
                              "20-24 years",
                              "25-29 years",
                              "30-34 years",
                              "35-39 years",
                              "40-44 years",
                              "45-49 years",
                              "50-54 years",
                              "55-59 years",
                              "60-64 years",
                              "65-69 years",
                              "70-74 years",
                              "75-79 years",
                              "80-84 years",
                              "85-89 years",
                              "90-94 years",
                              "95+ years",
                              "All ages"))
  
rm(GBD_POP_1990,GBD_POP_2019) #Dont waste my precious RAM

SDI <- SDI %>%
          filter(Location %in% c("Argentina",
                 "Bolivia",
                 "Brazil",
                 "Chile",
                 "Colombia",
                 "Ecuador",
                 "Guyana",
                 "Paraguay",
                 "Peru",
                 "Suriname",
                 "Uruguay",
                 "Venezuela")) %>%
          select("Location", "1990", "2019") %>%
          pivot_longer(cols = c("1990", "2019"),
                       names_to = "year",
                       values_to = "SDI")

GBDrates <- GBDrates %>%
            mutate(measure = recode(measure,
            "YLDs (Years Lived with Disability)" = "YLDs",
            "YLLs (Years of Life Lost)" = "YLLs",
            "DALYs (Disability-Adjusted Life Years)" = "DALYs")) %>%
            mutate(location = recode(location,
           "Bolivia (Plurinational State of)" = "Bolivia",
           "Venezuela (Bolivarian Republic of)" = "Venezuela")) %>%
            mutate(year_end = as.factor(year_end)) %>%
            select(-c("rei", "year_start")) %>%
            rename(ROC_val = val, 
                   ROC_upper = upper, 
                   ROC_lower = lower,
                   year = year_end)


SA_map <- ne_countries(scale = "medium",
                   type = "map_units",
                   returnclass = "sf") %>%
      filter(name %in% c("Argentina",
                         "Bolivia",
                         "Brazil",
                         "Chile",
                         "Colombia",
                         "Ecuador",
                         "Guyana",
                         "Paraguay",
                         "Peru",
                         "Suriname",
                         "Uruguay",
                         "Venezuela"))


GBD <- GBD %>%
        full_join(SDI, by = c("location" = "Location", "year" = "year")) %>%
        full_join(GBD_POP, by=c("location"="location",
                                "age"="age",
                                "sex"="sex",
                                "year"="year")) %>% 
        full_join(GBDrates, by=c("location" = "location",
                                 "measure" = "measure",
                                 "sex" = "sex",
                                 "cause" = "cause",
                                 "metric" = "metric",
                                 "year" = "year",
                                 "age" = "age"))

rm(GBD_POP, SDI, GBDrates) #Dont waste my precious RAM
```

### Making graphs:

#### South America(SA)

DALYs, YLDs, YLLs and deaths (number and rates) in SA in 2019 - ALL AGES, ALL CAUSES

```{r eval=FALSE, fig.width=15, include=FALSE}
GBD_SA %>%
 filter(cause %in% "All causes") %>%
 ggplot() +
 aes(x = measure, y = val_rate, fill = measure) +
 geom_col() +
 scale_fill_hue(direction = 1) +
 labs(y = "rate (per 100.000)", title = "DALYs, YLDs, YLLs and Deaths rate (per 100.000) in South America in 1990 and 2019 (all ages, all causes)", 
 fill = " ") +
 coord_flip() +
 ggthemes::theme_base() +
 theme(legend.position = "top") +
 facet_wrap(vars(year)) +
 ylim(0, 2500)


```

```{r eval=FALSE, fig.width=15, include=FALSE}
GBD_SA %>%
 filter(cause %in% "All causes") %>%
 ggplot() +
 aes(x = measure, y = val, fill = measure) +
 geom_col() +
 scale_fill_hue(direction = 1) +
 labs(y = "number", title = "DALYs, YLDs, YLLs and Deaths (number) in South America in 1990 and 2019 (all ages, all causes)", 
 fill = " ") +
 coord_flip() +
 ggthemes::theme_base() +
 theme(legend.position = "top") +
 facet_wrap(vars(year), 
 scales = "free_y")
```

DALYs, YLDs, YLLs and deaths (number and rates) in SA in 1990 and 2019 - AGE GROUPS, ALL CAUSES

```{r eval=FALSE, fig.width=15, include=FALSE}
p1 <- dalys_all_causes_num %>%
  group_by(measure, sex, age, year) %>% 
  summarise(val = sum(val)) %>%
  filter(sex == "Both", measure != "DALYs")

ggplot(p1) +
  aes(x = age, fill = measure, weight = val) +
  geom_bar() +
  scale_fill_hue(direction = 1) +
  ggthemes::theme_base() +
  theme(legend.position = "top") +
  facet_wrap(vars(year))+
  labs(y = "number", 
       title = "DALYs(YLDs + YLLs) for all causes for HFPG in number in South America in 1990 and 2019", fill = " ")
```

```{r}

```

```{r}

```

```{r}

```

```{r eval=FALSE, include=FALSE}
p1 <- GBD %>%
      filter(year == "2019", measure == "DALYs",
             sex =="Both", metric =="Rate", cause == "All causes")

  
  
  
      ggplot(p1,
        mapping = aes(x = location, y = val)) +
        geom_col(width = 0.5, fill = "#b19cd9") +
        geom_errorbar(aes(ymin = lower, ymax = upper),
                      colour = "black", width = .1)+
        labs(title = "Rate of DALYS in South America countries for HFPG in 2019",
             y = "DALYs(rate)", x = "Country") +
        theme_bw() +
        theme(axis.text.x = element_text(hjust = 1,
                                         angle = 45,
                                         size = 10))
```

#### YLDs and YLLs for males and females in 2019 - 2019 for HFPG each country

```{r eval=FALSE, include=FALSE}
p2 <- GBD %>%
      filter (cause == "All causes", metric == "Rate",
              measure != "DALYs", measure != "Deaths",
              age == "Age-standardized") 


ggplot() +
  geom_bar(data = p2 %>% filter(year == 2019),
           mapping = aes(x = location, y = val, fill = measure, alpha = 0.8),
           stat = "identity", width = 0.3) +
  facet_wrap(vars(sex))+
  labs(x = "", y = "DALYs", fill = "") +
  ggthemes::theme_base() +
  theme(
        axis.text.x = element_text(hjust = 1,
                                   angle = 45,
                                   size = 8))+
  coord_cartesian(ylim = c(0,7000))

        
ggplot() +
  geom_bar(data = p2 %>% filter(year == 1990),
           mapping = aes(x = location, y = val, fill = measure),
           stat = "identity", width = 0.3) +

  facet_wrap(vars(sex))+
  labs(x = "", y = "DALYs", fill = "") +
  ggthemes::theme_base() +
  theme(
        axis.text.x = element_text(hjust = 1,
                                   angle = 45,
                                   size = 8))+
  coord_cartesian(ylim = c(0,7000))

ggplot(p2) +
  aes(x = year, fill = measure, weight = val) +
  geom_bar(width = 1) +
  labs(x = "", y = "DALYs per 100.000", fill = "",
       title = "Rate of DALYs by location, sex and year") +
  ggthemes::theme_base() +
  facet_grid(vars(sex), vars(location))+
  theme(
      axis.text.x = element_text(hjust = 1,
                                 angle = 45,
                                 size = 8),
      axis.text.y = element_text(hjust = 0,5,
                                 angle = 0,
                                 size = 8),
      strip.text.x = element_text(
                                 angle = 45,
                                 size = 8),
      strip.text.y = element_text(hjust = 0.8, size = 8),
          
      panel.background = element_blank(),
      panel.border = element_blank())+
  

  coord_cartesian(ylim = c(0,7000))


      
```

```{r eval=FALSE, include=FALSE}


p3 <- GBD %>%
     filter(cause == "All causes") %>%
     filter(metric == "Rate") %>% 
     filter(age == "Age-standardized")
    
    
ggplot()+
    geom_line(data = p3 %>% filter (measure == "DALYs"),
              aes(x = year, y = val,
                  color = measure, group = measure))+
    geom_line(data = p3 %>% filter (measure == "YLDs"),
              aes(x = year, y = val,
                  color = measure, group = measure))+
    geom_line(data = p3 %>% filter (measure == "YLLs"),
              aes(x = year, y = val,
                  color = measure, group = measure))+
    geom_point(data = p3 %>% filter (measure == "DALYs"),
              aes(x = year, y = val,
                  color = measure, group = measure))+
    geom_point(data = p3 %>% filter (measure == "YLDs"),
              aes(x = year, y = val,
                  color = measure, group = measure))+
    geom_point(data = p3 %>% filter (measure == "YLLs"),
              aes(x = year, y = val,
                  color = measure, group = measure))+
    facet_grid(vars(sex), vars(location))+
   theme_minimal() +
    facet_grid(vars(sex), vars(location))+
    theme(
        axis.text.x = element_text(hjust = 1,
                                   angle = 45,
                                   size = 8),
        axis.text.y = element_text(hjust = 0,5,
                                   angle = 0,
                                   size = 8),
        strip.text.x = element_text(
                                   angle = 45,
                                   size = 8),
        strip.text.y = element_text(hjust = 0.8, size = 8),
            
        panel.background = element_blank(),
        panel.border = element_blank())+
    

    coord_cartesian(ylim = c(0,7000))+
    labs(x = "", y = "Measure per 100.000", fill = "Measure",
           title = "Rate of DALYs, YLDs and YLLs by location, sex and year")


```

#### Heatmaps...

```{r eval=FALSE, include=FALSE}
p4 <- GBD %>% 
      filter (metric =="Rate", year == "2019", sex == "Both",
              measure == "DALYs", age == "Age-standardized")
      
  
  
  ggplot(p4, mapping = aes(x = location, y = cause, fill = val_cat))+
      geom_tile(color = "white", lwd = 0)+
     
      geom_shadowtext(aes(label = round(val, digits = 0)), color = "white",
                size = 2.3) +
      scale_fill_viridis_d(direction = -1)+
      theme_minimal() +
      
      labs(title = "DALYs per 100.000 for each cause
           by country in 2019, both sexes", fill = "DALYs per 100.000",
           x = "", y= "")+
            theme(
              axis.text.x = element_text(hjust = 1,
                                         angle = 45,
                                         size = 8),
              plot.title = element_text(hjust = 0.9))
  
  
  
  
  
```

```{r eval=FALSE, fig.height=20, fig.width=20, include=FALSE}
p5 <- GBD %>% 
      filter (metric =="Rate", sex == "Both", age == "Age-standardized")
    
  
ggplot()+
geom_tile(data = p5, 
          mapping = aes(x = location, 
                        y = cause, 
                        fill = val_cat),
          color = "white")+
geom_shadowtext(data = p5,
                aes(x = location,
                    y = cause,
                    label = round(val, digits = 0)),
                color = "white",
                size = 2.3) +
facet_grid(vars(year), vars(measure))+
scale_fill_viridis_d(direction = -1)+
theme_minimal() +
coord_fixed(ratio = 1)+
labs(title = "DALYs, YLDs, YLLs and deaths related to HFPG per 100.000 by cause for South America countries in 1990 and 2019", 
     fill = "Measure per 100.000", y = "", x = "")+
theme(axis.text.x = element_text(hjust = 1,
                                 angle = 45,
                                 size = 6),
      plot.title = element_text(hjust = 0.5),
      title = element_text(size = 7))

```

```{r eval=FALSE, include=FALSE}
p6 <- GBD %>%
 filter(measure == "DALYs") %>%
 filter(sex == "Both") %>%
 filter(cause == "All causes") %>%
 filter(metric == "Rate") %>%
 filter(year == "2019") %>%
 filter(age == "Age-standardized")
 
ggplot(p6, aes(x = SDI, y = ROC_val)) +
  geom_point(aes(fill = location,
                 colour = location),
             size = 3) +
  geom_text(x = p6$SDI, 
            y = p6$ROC_val+0.03, 
            label = p6$sov_a3, size = 3)+
  scale_fill_hue(direction = 1) +
  scale_color_hue(direction = 1) +
  geom_hline(yintercept = 0, colour = "gray")+
  theme_classic()+
  labs(y = "DALYs anual rate of change in 1990-2019(%)",
       x = "SDI in 2019")
```

Let's start with a map of South America

```{r eval=FALSE, include=FALSE}
p7 <- GBD %>% filter(measure == "DALYs", 
               metric == "Rate",
               year == "2019",
               sex == "Both",
               cause == "All causes",
               age == "Age-standardized")



ggplot()+
  geom_sf(data = SA)+
  coord_sf(xlim = c(-35,-85))+
  theme_classic()



```
